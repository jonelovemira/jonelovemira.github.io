<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>ipc-web重构 (六) 基础组件建设 | 标题</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="因为在ipc-web前端的需求中明确定义了各种UI组件的显示与交互方式，同时要求需要对IE8兼容(前端开发人员的噩耗)。所以为了高保真的还原这些设计，我们需要自己定制各种UI组件，例如弹窗类(包括confirm, alert, info)，select等。
UI组件开发这些组件可以以jQuery插件的方式来进行拓展，而且github有相当多的优秀的jquery插件。要很好的利用这些资源，因为遇到问">
<meta property="og:type" content="article">
<meta property="og:title" content="ipc-web重构 (六) 基础组件建设">
<meta property="og:url" content="http://yoursite.com/2016/04/22/ipc-web重构 (六) 基础组件建设/index.html">
<meta property="og:site_name" content="标题">
<meta property="og:description" content="因为在ipc-web前端的需求中明确定义了各种UI组件的显示与交互方式，同时要求需要对IE8兼容(前端开发人员的噩耗)。所以为了高保真的还原这些设计，我们需要自己定制各种UI组件，例如弹窗类(包括confirm, alert, info)，select等。
UI组件开发这些组件可以以jQuery插件的方式来进行拓展，而且github有相当多的优秀的jquery插件。要很好的利用这些资源，因为遇到问">
<meta property="og:image" content="http://yoursite.com/images/select-event-change-path.png">
<meta property="og:image" content="http://yoursite.com/images/select-before-change.png">
<meta property="og:updated_time" content="2016-05-11T09:55:59.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ipc-web重构 (六) 基础组件建设">
<meta name="twitter:description" content="因为在ipc-web前端的需求中明确定义了各种UI组件的显示与交互方式，同时要求需要对IE8兼容(前端开发人员的噩耗)。所以为了高保真的还原这些设计，我们需要自己定制各种UI组件，例如弹窗类(包括confirm, alert, info)，select等。
UI组件开发这些组件可以以jQuery插件的方式来进行拓展，而且github有相当多的优秀的jquery插件。要很好的利用这些资源，因为遇到问">
<meta name="twitter:image" content="http://yoursite.com/images/select-event-change-path.png">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://www.weixinqz.com/uploadfile/2014/1211/20141211051701675.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Jone Xu</a></h1>
		</hgroup>

		
		<p class="header-subtitle">副标题</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="#" title="github">github</a>
					        
								<a class="mail" target="_blank" href="#" title="mail">mail</a>
					        
								<a class="facebook" target="_blank" href="#" title="facebook">facebook</a>
					        
								<a class="twitter" target="_blank" href="#" title="twitter">twitter</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/ipc-web/" style="font-size: 10px;">ipc-web</a> <a href="/tags/front-end/" style="font-size: 10px;">前端</a> <a href="/tags/refactor/" style="font-size: 10px;">重构</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">卡卡的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">本泽马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">吉格斯的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">托蒂的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Jone Xu</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://www.weixinqz.com/uploadfile/2014/1211/20141211051701675.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Jone Xu</h1>
			</hgroup>
			
			<p class="header-subtitle">副标题</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github">github</a>
			        
						<a class="mail" target="_blank" href="#" title="mail">mail</a>
			        
						<a class="facebook" target="_blank" href="#" title="facebook">facebook</a>
			        
						<a class="twitter" target="_blank" href="#" title="twitter">twitter</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-ipc-web重构 (六) 基础组件建设" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/04/22/ipc-web重构 (六) 基础组件建设/" class="article-date">
  	<time datetime="2016-04-22T02:04:47.000Z" itemprop="datePublished">2016-04-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ipc-web重构 (六) 基础组件建设
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ipc-web/">ipc-web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/front-end/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/refactor/">重构</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/javascript/">javascript</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><br>因为在ipc-web前端的需求中明确定义了各种UI组件的显示与交互方式，同时要求需要对IE8兼容(前端开发人员的噩耗)。所以为了高保真的还原这些设计，我们需要自己定制各种UI组件，例如弹窗类(包括confirm, alert, info)，select等。</p>
<h4 id="UI组件"><a href="#UI组件" class="headerlink" title="UI组件"></a>UI组件</h4><p>开发这些组件可以以jQuery插件的方式来进行拓展，而且github有相当多的优秀的jquery插件。要很好的利用这些资源，因为遇到问题可以很快的上面找到答案，同时可以向优秀的人学习他们的思维方式。</p>
<ul>
<li><p>jQuery插件拓展基本方式如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jQuery.fn.myPlugin = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="comment">// 插件代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是为了避免和其他库中的<code>$</code>冲突的话，可以将jQuery作为参数传递给一个自我执行的封闭程序，jQuery在此程序中映射为<code>$</code>符号，这样可以避免<code>$</code>号被其他库覆写，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line">    $.fn.myPlugin = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 插件代码</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)(jQuery);</span><br></pre></td></tr></table></figure>
<p>本项目的基础组件代码请查询select.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line"><span class="meta">    "use strict"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> tmpSelect = &#123;</span><br><span class="line">        mainTemplate: <span class="string">'&lt;div class="plugin-select"&gt;'</span> +</span><br><span class="line">            <span class="string">'&lt;div class="selected"&gt;&lt;span lang="en"&gt;&lt;/span&gt;&lt;/div&gt;'</span> +</span><br><span class="line">            <span class="string">'&lt;div class="triangle"&gt;&lt;/div&gt;'</span> +</span><br><span class="line">            <span class="string">'&lt;div class="slide"&gt;'</span> +</span><br><span class="line">            <span class="string">'&lt;div class="slide-item-holder"&gt;&lt;/div&gt;'</span> +</span><br><span class="line">            <span class="string">'&lt;/div&gt;'</span> +</span><br><span class="line">            <span class="string">'&lt;div class="expand-collapse"&gt;&lt;/div&gt;'</span> +</span><br><span class="line">            <span class="string">'&lt;/div&gt;'</span>,</span><br><span class="line">        optionTemplate: <span class="string">'&lt;div class="slide-item" xvalue=""&gt;&lt;span lang="en"&gt;&lt;/span&gt;&lt;/div&gt;'</span>,</span><br><span class="line">        uniqueAttrKey: <span class="string">'only-for-plugin-select'</span>,</span><br><span class="line">        uniqueAttrValuePrefix: <span class="string">'i-am-unique-'</span>,</span><br><span class="line">        collapse: <span class="function"><span class="keyword">function</span>(<span class="params">select</span>) </span>&#123;</span><br><span class="line">            select.removeClass(<span class="string">"select-slide"</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        addSelectOptionElements: <span class="function"><span class="keyword">function</span>(<span class="params">select, selectOptionElements</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> htmlStr = <span class="string">""</span>;</span><br><span class="line">            selectOptionElements.each(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> ($(<span class="keyword">this</span>).css(<span class="string">"display"</span>) != <span class="string">"none"</span>) &#123;</span><br><span class="line">                    htmlStr += <span class="string">'&lt;div class="slide-item" xvalue="'</span> + </span><br><span class="line">                       $(<span class="keyword">this</span>).attr(<span class="string">"value"</span>) + <span class="string">'"&gt;&lt;span lang="en"&gt;'</span> + </span><br><span class="line">                       $(<span class="keyword">this</span>).html() + <span class="string">'&lt;/span&gt;&lt;/div&gt;'</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;);</span><br><span class="line">            select.find(<span class="string">".slide-item-holder"</span>).append(htmlStr);</span><br><span class="line">        &#125;,</span><br><span class="line">        addSelectOptionForOrigin: <span class="function"><span class="keyword">function</span>(<span class="params">originSelect, selectOptionElements</span>) </span>&#123;</span><br><span class="line">            originSelect.append(selectOptionElements);</span><br><span class="line">        &#125;,</span><br><span class="line">        changeFromOrigin: <span class="function"><span class="keyword">function</span>(<span class="params">select, originSelect</span>) </span>&#123;</span><br><span class="line">            originSelect.change(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                tmpSelect.feedSelectValue(select, originSelect);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        expand: <span class="function"><span class="keyword">function</span>(<span class="params">select</span>) </span>&#123;</span><br><span class="line">            select.addClass(<span class="string">"select-slide"</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        updateDisplayStyle: <span class="function"><span class="keyword">function</span>(<span class="params">select, _options, originSelect</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> pluginSelectWidth = originSelect.width() == <span class="number">0</span> ? </span><br><span class="line">               _options.pluginSelectWidth : originSelect.outerWidth();</span><br><span class="line">            <span class="keyword">var</span> maxDisplayContainerWidth = _options.optionWidth || pluginSelectWidth;</span><br><span class="line">            <span class="keyword">var</span> tmpSelectOptionHeight = _options.slideOptionHeight;</span><br><span class="line">            <span class="keyword">var</span> totalOptionHeightWithoutScroll = (tmpSelectOptionHeight + <span class="number">8</span>) * </span><br><span class="line">               select.find(<span class="string">".slide-item"</span>).length;</span><br><span class="line">            <span class="keyword">var</span> maxDisplayContainerHeight = <span class="built_in">Math</span>.min(_options.slideMaxHeight, </span><br><span class="line">               totalOptionHeightWithoutScroll);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">undefined</span> == pluginSelectWidth || pluginSelectWidth &lt;= <span class="number">30</span> ||</span><br><span class="line">                <span class="literal">undefined</span> == maxDisplayContainerWidth ||</span><br><span class="line">                <span class="literal">undefined</span> == tmpSelectOptionHeight || <span class="literal">undefined</span> == totalOptionHeightWithoutScroll ||</span><br><span class="line">                <span class="literal">undefined</span> == maxDisplayContainerHeight) &#123;</span><br><span class="line">                <span class="built_in">console</span>.error(<span class="string">"args error for init plugin-select"</span>);</span><br><span class="line">            &#125;;</span><br><span class="line">            select.width(pluginSelectWidth);</span><br><span class="line">            select.find(<span class="string">".selected"</span>).width(pluginSelectWidth - <span class="number">30</span>);</span><br><span class="line">            select.find(<span class="string">".slide"</span>).width(maxDisplayContainerWidth)</span><br><span class="line">               .height(maxDisplayContainerHeight);</span><br><span class="line">            select.find(<span class="string">".slide-item"</span>).height(tmpSelectOptionHeight);</span><br><span class="line">            select.find(<span class="string">".slide-item-holder"</span>).width(maxDisplayContainerWidth)</span><br><span class="line">               .height(totalOptionHeightWithoutScroll);</span><br><span class="line">            select.css(<span class="string">"position"</span>, originSelect.css(<span class="string">"position"</span>));</span><br><span class="line">            select.css(<span class="string">"left"</span>, originSelect.css(<span class="string">"left"</span>));</span><br><span class="line">            select.css(<span class="string">"top"</span>, originSelect.css(<span class="string">"top"</span>));</span><br><span class="line">        &#125;,</span><br><span class="line">        generateAddedOptionElements: <span class="function"><span class="keyword">function</span>(<span class="params">addedOptions</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">undefined</span> == addedOptions) &#123;</span><br><span class="line">                <span class="keyword">return</span> $(<span class="string">""</span>);</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">var</span> optionPrefix = <span class="string">"&lt;option&gt;"</span>;</span><br><span class="line">            <span class="keyword">var</span> optionPostfix = <span class="string">"&lt;/option&gt;"</span>;</span><br><span class="line">            <span class="keyword">var</span> htmlStr = <span class="string">""</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> addedOptions) &#123;</span><br><span class="line">                htmlStr += optionPrefix + key + optionPostfix;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">return</span> $(htmlStr);</span><br><span class="line">        &#125;,</span><br><span class="line">        feedSelectValue: <span class="function"><span class="keyword">function</span>(<span class="params">select, originSelect</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> selectedValue;</span><br><span class="line">            <span class="keyword">if</span> (originSelect.val()) &#123;</span><br><span class="line">                selectedValue = originSelect.find(<span class="string">":selected"</span>).html() || originSelect.val();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                selectedValue = originSelect.find(<span class="string">"option:first"</span>).html();</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            select.find(<span class="string">".selected span"</span>).html(selectedValue);</span><br><span class="line">        &#125;,</span><br><span class="line">        feedTemplate: <span class="function"><span class="keyword">function</span>(<span class="params">select, originSelect, options</span>) </span>&#123;</span><br><span class="line">            select.toggleClass(<span class="string">"select-disabled"</span>, options.disabled);</span><br><span class="line">            tmpSelect.feedSelectValue(select, originSelect);</span><br><span class="line">        &#125;,</span><br><span class="line">        generatePluginConstructOption: <span class="function"><span class="keyword">function</span>(<span class="params">options, originSelect</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _options = $.extend(<span class="literal">true</span>, &#123;&#125;, $.fn.Select.defaults, options)</span><br><span class="line">            <span class="keyword">var</span> optionWidth = originSelect.attr(<span class="string">"select-width"</span>);</span><br><span class="line">            <span class="keyword">if</span> (optionWidth) &#123;</span><br><span class="line">                _options.optionWidth = <span class="built_in">parseInt</span>(optionWidth);</span><br><span class="line">            &#125;;</span><br><span class="line">            _options.disabled = originSelect.attr(<span class="string">"disabled"</span>) == <span class="string">"disabled"</span>;</span><br><span class="line">            <span class="keyword">return</span> _options;</span><br><span class="line">        &#125;,</span><br><span class="line">        generateSelectId: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> tmpSelect.uniqueAttrValuePrefix + $.now() + <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">6</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        onClick: <span class="function"><span class="keyword">function</span>(<span class="params">select, e, originSelect</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> screenAvailableHeight = screen.availHeight;</span><br><span class="line">            <span class="keyword">var</span> selectPositionY = e.pageY;</span><br><span class="line">            <span class="keyword">var</span> slideContainer = select.find(<span class="string">".slide"</span>);</span><br><span class="line">            <span class="keyword">if</span> (screenAvailableHeight - selectPositionY &lt; slideContainer.height()) &#123;</span><br><span class="line">                slideContainer.css(&#123;</span><br><span class="line">                    <span class="string">"bottom"</span>: select.height(),</span><br><span class="line">                    <span class="string">"top"</span>: <span class="string">""</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                slideContainer.css(&#123;</span><br><span class="line">                    <span class="string">"top"</span>: select.height(),</span><br><span class="line">                    <span class="string">"bottom"</span>: <span class="string">""</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (select.hasClass(<span class="string">"select-slide"</span>)) &#123;</span><br><span class="line">                select.removeClass(<span class="string">"select-slide"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $(<span class="string">".select-slide"</span>).removeClass(<span class="string">"select-slide"</span>);</span><br><span class="line">                select.addClass(<span class="string">"select-slide"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            originSelect.focus();</span><br><span class="line"></span><br><span class="line">            e.stopPropagation();</span><br><span class="line">        &#125;,</span><br><span class="line">        onOptionClick: <span class="function"><span class="keyword">function</span>(<span class="params">select, e, originSelect, selectedOption</span>) </span>&#123;</span><br><span class="line">            select.removeClass(<span class="string">"select-slide"</span>);</span><br><span class="line">            <span class="keyword">var</span> value = selectedOption.attr(<span class="string">"xvalue"</span>);</span><br><span class="line">            <span class="keyword">var</span> selectedText = selectedOption.text();</span><br><span class="line">            <span class="keyword">var</span> oldText = select.find(<span class="string">".selected span"</span>).text();</span><br><span class="line">            originSelect.val(value);</span><br><span class="line">            <span class="keyword">if</span> (oldText != selectedText) &#123;</span><br><span class="line">                (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    originSelect.trigger(<span class="string">"beforeChange"</span>);</span><br><span class="line">                    <span class="keyword">return</span> originSelect.data(<span class="string">"canChange"</span>);</span><br><span class="line">                &#125;).after(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    originSelect.change();</span><br><span class="line">                    select.find(<span class="string">".selected span"</span>).text(selectedText);</span><br><span class="line">                &#125;)();</span><br><span class="line">            &#125;;</span><br><span class="line">            e.stopPropagation();</span><br><span class="line">        &#125;,</span><br><span class="line">        addScrollbar: <span class="function"><span class="keyword">function</span>(<span class="params">select</span>) </span>&#123;</span><br><span class="line">            select.find(<span class="string">".slide"</span>).Scrollbar(&#123;</span><br><span class="line">                target: select.find(<span class="string">".slide .slide-item-holder"</span>)</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> bodyClicking = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    $.fn.Select = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> originSelect = $(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">var</span> _options = tmpSelect.generatePluginConstructOption(options, originSelect);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> id = originSelect.attr(tmpSelect.uniqueAttrKey) || tmpSelect.generateSelectId();</span><br><span class="line">        <span class="keyword">if</span> ($(<span class="string">"#"</span> + id).length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            $(<span class="string">"#"</span> + id).remove();</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> select = $(tmpSelect.mainTemplate);</span><br><span class="line"></span><br><span class="line">        select.attr(<span class="string">"id"</span>, id);</span><br><span class="line">        originSelect.attr(tmpSelect.uniqueAttrKey, id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> addedOptionElements = tmpSelect.generateAddedOptionElements(_options.addedOptions);</span><br><span class="line">        tmpSelect.addSelectOptionForOrigin(originSelect, addedOptionElements);</span><br><span class="line"></span><br><span class="line">        tmpSelect.feedTemplate(select, originSelect, _options);</span><br><span class="line"></span><br><span class="line">        tmpSelect.addSelectOptionElements(select, originSelect.find(<span class="string">"option"</span>));</span><br><span class="line"></span><br><span class="line">        tmpSelect.updateDisplayStyle(select, _options, originSelect);</span><br><span class="line">        tmpSelect.addScrollbar(select);</span><br><span class="line"></span><br><span class="line">        select.insertBefore(originSelect);</span><br><span class="line"></span><br><span class="line">        select.on(<span class="string">'mouseup'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            bodyClicking = <span class="literal">false</span>;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        $(<span class="string">'.expand-collapse'</span>, select).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">            tmpSelect.onClick(select, e, originSelect);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        $(<span class="string">'.slide-item'</span>, select).on(<span class="string">'mousedown'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">            tmpSelect.onOptionClick(select, e, originSelect, $(<span class="keyword">this</span>));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        tmpSelect.changeFromOrigin(select, originSelect);</span><br><span class="line">        originSelect.hide();</span><br><span class="line">        tmpSelect.collapse(select);</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    $.fn.Select.defaults = &#123;</span><br><span class="line">        pluginSelectWidth: <span class="number">200</span>,</span><br><span class="line">        optionWidth: <span class="literal">null</span>,</span><br><span class="line">        slideMaxHeight: <span class="number">288</span>,</span><br><span class="line">        slideOptionHeight: <span class="number">16</span>,</span><br><span class="line">        hotKey: <span class="literal">false</span>,</span><br><span class="line">        disabled: <span class="literal">false</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $(<span class="built_in">document</span>).on(<span class="string">"mousedown"</span>, <span class="string">"body"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        bodyClicking = <span class="literal">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="built_in">document</span>).on(<span class="string">"mouseup"</span>, <span class="string">"body"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (bodyClicking) &#123;</span><br><span class="line">            $(<span class="string">'div.select-slide'</span>).removeClass(<span class="string">"select-slide"</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;)(jQuery);</span><br></pre></td></tr></table></figure>
<p>以及msg.js。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"> (<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line"><span class="meta">     "use strict"</span>;</span><br><span class="line"></span><br><span class="line">     $.ipc = $.ipc || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">var</span> Msg = &#123;</span><br><span class="line">         ID: <span class="number">0</span>,</span><br><span class="line">         mainTemplate: <span class="string">'&lt;div &gt;'</span> +</span><br><span class="line">             <span class="string">'&lt;div class="window-msg-bg"&gt;&lt;/div&gt;'</span> +</span><br><span class="line">             <span class="string">'&lt;div class="window-msg-holder"&gt;'</span> +</span><br><span class="line">             <span class="string">'&lt;div class="window-msg-contain"&gt;'</span> +</span><br><span class="line">             <span class="string">'&lt;div class="window-msg-head"&gt;'</span> +</span><br><span class="line">             <span class="string">'&lt;span class="window-msg-head-title" lang="en"&gt;&lt;/span&gt;'</span> +</span><br><span class="line">             <span class="string">'&lt;/div&gt;'</span> +</span><br><span class="line">             <span class="string">'&lt;div class="window-msg-body"&gt;'</span> +</span><br><span class="line">             <span class="string">'&lt;div class="window-msg-body-content"&gt;&lt;span lang="en"&gt;'</span> +</span><br><span class="line">             <span class="string">'&lt;/span&gt;&lt;/div&gt;'</span> +</span><br><span class="line">             <span class="string">'&lt;/div&gt;'</span> +</span><br><span class="line">             <span class="string">'&lt;div class="window-msg-body-foot"&gt;'</span> +</span><br><span class="line">             <span class="string">'&lt;/div&gt;'</span> +</span><br><span class="line">             <span class="string">'&lt;/div&gt;'</span> +</span><br><span class="line">             <span class="string">'&lt;/div&gt;'</span> +</span><br><span class="line">             <span class="string">'&lt;/div&gt;'</span>,</span><br><span class="line">         closeIconTemplate: <span class="string">'&lt;span class="window-msg-head-close"&gt;&lt;/span&gt;'</span>,</span><br><span class="line">         btnTemplate: <span class="string">'&lt;input class="window-msg-btn" value="OK" lang="en" type="button" /&gt;'</span>,</span><br><span class="line">         close: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">             <span class="keyword">var</span> context = msg.parent();</span><br><span class="line">             $(<span class="string">'body'</span>).unbind(<span class="string">'keydown'</span>, Msg.hotClose);</span><br><span class="line">             msg.remove();</span><br><span class="line">             msg.option.afterClose();</span><br><span class="line">             <span class="keyword">return</span> context;</span><br><span class="line">         &#125;,</span><br><span class="line">         cancel: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">             <span class="keyword">var</span> context = msg.parent();</span><br><span class="line">             msg.option.cancel();</span><br><span class="line">             <span class="keyword">return</span> Msg.close(msg);</span><br><span class="line">         &#125;,</span><br><span class="line">         confirm: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">             <span class="keyword">var</span> context = msg.parent();</span><br><span class="line">             msg.option.confirm();</span><br><span class="line">             <span class="keyword">return</span> Msg.close(msg);</span><br><span class="line">         &#125;,</span><br><span class="line">         ok: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">             <span class="keyword">var</span> context = msg.parent();</span><br><span class="line">             msg.option.ok();</span><br><span class="line">             <span class="keyword">return</span> Msg.close(msg);</span><br><span class="line">         &#125;,</span><br><span class="line">         hotClose: <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">             <span class="keyword">if</span> (event.keyCode == <span class="string">"27"</span>) &#123;</span><br><span class="line">                 Msg.close(event.data.msg);</span><br><span class="line">             &#125;;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">     &#125;;</span><br><span class="line"></span><br><span class="line">     $.ipc.Msg = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">var</span> _options = $.extend(<span class="literal">true</span>, &#123;&#125;, $.ipc.Msg.defaults, options);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">var</span> id = <span class="string">"Msg-1"</span>;</span><br><span class="line">         <span class="keyword">if</span> ($(<span class="string">"#"</span> + id).length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">             $(<span class="string">"#"</span> + id).remove();</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">var</span> rHtml = Msg.mainTemplate;</span><br><span class="line">         <span class="keyword">var</span> msg = $(rHtml);</span><br><span class="line"></span><br><span class="line">         <span class="comment">//render id, title, info, button and size</span></span><br><span class="line">         msg.attr(<span class="string">"id"</span>, id);</span><br><span class="line">         $(<span class="string">'.window-msg-head-title'</span>, msg).text(_options.title);</span><br><span class="line">         $(<span class="string">'.window-msg-body-content span'</span>, msg).html(_options.info);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">switch</span> (_options.type) &#123;</span><br><span class="line">             <span class="keyword">case</span> <span class="string">"alert"</span>:</span><br><span class="line">                 $(<span class="string">'.window-msg-body-foot'</span>, msg).append(Msg.btnTemplate);</span><br><span class="line">                 $(<span class="string">'.window-msg-btn:first'</span>, msg).attr(<span class="string">"value"</span>, _options.btnOk);</span><br><span class="line">                 $(<span class="string">'.window-msg-btn:first'</span>, msg).attr(<span class="string">"for"</span>, <span class="string">"ok"</span>);</span><br><span class="line">                 <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">             <span class="keyword">case</span> <span class="string">"confirm"</span>:</span><br><span class="line">                 $(<span class="string">'.window-msg-body-foot'</span>, msg).append(Msg.btnTemplate);</span><br><span class="line">                 $(<span class="string">'.window-msg-body-foot'</span>, msg).append(Msg.btnTemplate);</span><br><span class="line">                 $(<span class="string">'.window-msg-btn:first'</span>, msg).attr(<span class="string">"value"</span>, _options.btnCancel);</span><br><span class="line">                 $(<span class="string">'.window-msg-btn:first'</span>, msg).attr(<span class="string">"for"</span>, <span class="string">"cancel"</span>);</span><br><span class="line">                 $(<span class="string">'.window-msg-btn:last'</span>, msg).attr(<span class="string">"value"</span>, _options.btnConfirm);</span><br><span class="line">                 $(<span class="string">'.window-msg-btn:last'</span>, msg).attr(<span class="string">"for"</span>, <span class="string">"confirm"</span>);</span><br><span class="line">                 <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">             <span class="keyword">case</span> <span class="string">"info"</span>:</span><br><span class="line">                 <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">             <span class="keyword">default</span>:</span><br><span class="line">                 $(<span class="string">'.window-msg-body-foot'</span>, msg).append(Msg.btnTemplate);</span><br><span class="line">                 $(<span class="string">'.window-msg-btn:first'</span>, msg).attr(<span class="string">"value"</span>, _options.btnOk);</span><br><span class="line">                 $(<span class="string">'.window-msg-btn:first'</span>, msg).attr(<span class="string">"for"</span>, <span class="string">"ok"</span>);</span><br><span class="line">                 <span class="keyword">break</span>;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         $(<span class="string">'.window-msg-contain'</span>, msg).css(&#123;</span><br><span class="line">             <span class="string">"width"</span>: _options.width,</span><br><span class="line">             <span class="string">"height"</span>: _options.height</span><br><span class="line">         &#125;);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (_options.closeIcon) &#123;</span><br><span class="line">             $(<span class="string">'.window-msg-head'</span>, msg).append(Msg.closeIconTemplate);</span><br><span class="line">         &#125;;</span><br><span class="line"></span><br><span class="line">         _options.beforeInit();</span><br><span class="line"></span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             msg.appendTo(<span class="string">'body'</span>);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">             <span class="built_in">console</span>.log(e);</span><br><span class="line">             <span class="built_in">console</span>.log(<span class="string">'can not append msg to body'</span>);</span><br><span class="line">             <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         msg.option = _options;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// add object functions. so we can dynamic call these functions.</span></span><br><span class="line">         msg.close = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">             Msg.close(msg);</span><br><span class="line">         &#125;;</span><br><span class="line"></span><br><span class="line">         msg.cancel = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">             Msg.cancel(msg);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         msg.confirm = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">             Msg.confirm(msg);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         msg.ok = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">             Msg.ok(msg);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         $(<span class="string">'.window-msg-btn'</span>, msg).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">             e.preventDefault();</span><br><span class="line">             <span class="keyword">var</span> type = $(<span class="keyword">this</span>).attr(<span class="string">"for"</span>);</span><br><span class="line">             Msg[type](msg);</span><br><span class="line">         &#125;);</span><br><span class="line"></span><br><span class="line">         $(<span class="string">'.window-msg-head-close'</span>, msg).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">             e.preventDefault();</span><br><span class="line">             Msg.close(msg);</span><br><span class="line">         &#125;);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (msg.option.hotKey) &#123;</span><br><span class="line">             $(<span class="string">'body'</span>).bind(<span class="string">'keydown'</span>, &#123;</span><br><span class="line">                 msg: msg</span><br><span class="line">             &#125;, Msg.hotClose);</span><br><span class="line">         &#125;;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span> msg;</span><br><span class="line">     &#125;;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// make default options writable outside</span></span><br><span class="line">     $.ipc.Msg.defaults = &#123;</span><br><span class="line">         type: <span class="string">"alert"</span>,</span><br><span class="line">         title: <span class="string">""</span>,</span><br><span class="line">         info: <span class="string">""</span>,</span><br><span class="line">         html: <span class="string">""</span>,</span><br><span class="line">         btnConfirm: <span class="string">"Confirm"</span>,</span><br><span class="line">         btnCancel: <span class="string">"Cancel"</span>,</span><br><span class="line">         btnOk: <span class="string">"OK"</span>,</span><br><span class="line">         width: <span class="number">400</span>,</span><br><span class="line">         height: <span class="number">260</span>,</span><br><span class="line">         hotKey: <span class="literal">true</span>,</span><br><span class="line">         closeIcon: <span class="literal">true</span>,</span><br><span class="line">         cancel: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">         ok: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">         confirm: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">         beforeInit: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">         afterClose: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">     &#125;;</span><br><span class="line">&#125;)(jQuery);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在使用select组件时，使用方式是现在html代码中写入原生态的select，然后后续封装的组件代码从页面中载入时自动根据原生态的select进行插件式select生成,换句话说，就是插件代码会在页面载入时对原生态的组件（例如select）打一个补丁，将原生态的组件隐藏，用户只会和我们封装定制好的组件交互。其中会进行一个双向绑定，操作封装组件会影响到原生态组件，代码操作原生态组件会反向影响封装的组件。controller中的监听事件均是在原生态的select上，这样就可以做到与封装的组件进行解耦，如果我们使用另外一个select插件，业务代码可以保持不变。</p>
<p>在使用封装select的时候遇到一个需求，即需要用户确认更改选择，该次select组件的change事件才生效，否则select原有值保持不变。封装select时产生的change事件传递如图：<br><img src="images/select-event-change-path.png" alt="select change event path"></p>
<p>用户看到的是selectWidget，那么当他触发change事件时，封装的selectWidget会触发原生态的select的change事件，业务逻辑得以执行。</p>
<p>值得一提的是，有一个特定的场景需要仔细思考设计一下：在业务逻辑中，有可能需要撤销selectWidget的change事件，也即是用户操作了selectWidget更换了它的值，但是也许这是一个非法操作（具体场景是用户在录制视频时切换分辨率的select，页面会提示是否确定中断录制视频，如果用户点击不中断的话，之前的selectWidget的change事件就是非法操作）需要撤销，将selectWidget的值恢复为原来的值。而此时controller的业务逻辑可以影响select（为了与selectWidget解耦），但是不能影响selectWidget（因为业务代码中不应该涉及到具体的封装，只涉及到原生态的select）。所以问题就是controller知道要恢复selectWidget的值，应该如何优雅的恢复。</p>
<p>解决方法是，在selectWidget触发change事件之前先触发beforeChange事件，这个事件可以决定是不是触发change(类似于window的onbeforeunload可以阻止unload事件一样)，事件驱动图如下：<br><img src="images/select-before-change.png" alt="select before change"></p>
<h4 id="基础库"><a href="#基础库" class="headerlink" title="基础库"></a>基础库</h4><ul>
<li><p>用于检测用户所使用的客户端浏览器类型与版本。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findBrowserTypeVersion</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ua = navigator.userAgent,</span><br><span class="line">        tem,</span><br><span class="line">        M = ua.match(<span class="regexp">/(opera|chrome|safari|firefox|msie|edge|trident(?=\/))\/?\s*(\d+)/i</span>) || [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> ieVer = <span class="number">0</span>; ieVer &lt; <span class="number">12</span>; ieVer++) &#123;</span><br><span class="line">        <span class="keyword">var</span> b = <span class="built_in">document</span>.createElement(<span class="string">'b'</span>)</span><br><span class="line">        b.innerHTML = <span class="string">'&lt;!--[if IE '</span> + ieVer + <span class="string">']&gt;&lt;i&gt;&lt;/i&gt;&lt;![endif]--&gt;'</span>;</span><br><span class="line">        <span class="keyword">if</span> (b.getElementsByTagName(<span class="string">'i'</span>).length === <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"MSIE "</span> + ieVer;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/trident/i</span>.test(M[<span class="number">1</span>])) &#123;</span><br><span class="line">        tem = <span class="regexp">/\brv[ :]+(\d+)/g</span>.exec(ua) || [];</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'MSIE '</span> + (tem[<span class="number">1</span>] || <span class="string">''</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (M[<span class="number">1</span>] === <span class="string">'Chrome'</span>) &#123;</span><br><span class="line">        tem = ua.match(<span class="regexp">/\bOPR\/(\d+)/</span>);</span><br><span class="line">        <span class="keyword">if</span> (tem != <span class="literal">null</span>) <span class="keyword">return</span> <span class="string">'Opera '</span> + tem[<span class="number">1</span>];</span><br><span class="line">        tem = ua.match(<span class="regexp">/Edge\/(\d+)/</span>);</span><br><span class="line">        <span class="keyword">if</span> (tem != <span class="literal">null</span>) <span class="keyword">return</span> <span class="string">'Edge '</span> + tem[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    M = M[<span class="number">2</span>] ? [M[<span class="number">1</span>], M[<span class="number">2</span>]] : [navigator.appName, navigator.appVersion, <span class="string">'-?'</span>];</span><br><span class="line">    <span class="keyword">if</span> ((tem = ua.match(<span class="regexp">/version\/(\d+)/i</span>)) != <span class="literal">null</span>) M.splice(<span class="number">1</span>, <span class="number">1</span>, tem[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> M.join(<span class="string">' '</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>做跨域请求时IE8不能使用jQuery封装的ajax(xmlhttprequest)，只能使用xdr(xmldomainrequest)，所以需要做一个库能够提供接口兼容这两种不同的浏览器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line"><span class="meta">    "use strict"</span>;</span><br><span class="line"></span><br><span class="line">    $.ipc = $.ipc || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ieXDomainAjax</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">window</span>.XDomainRequest == <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(<span class="string">"no XDomainRequest in current browser"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> xdr = <span class="keyword">new</span> XDomainRequest();</span><br><span class="line">        <span class="keyword">if</span> (xdr == <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(<span class="string">"can not create XDomainRequest instance"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> newOptions = $.extend(<span class="literal">true</span>, &#123;&#125;, $.xAjax.ieXDomainAjaxDefaults, options);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (newOptions.url == <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(<span class="string">"no url in ieXDomainAjax"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        xdr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            (options.error || <span class="function"><span class="keyword">function</span>(<span class="params">xdr</span>) </span>&#123;&#125;)(xdr);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        xdr.ontimeout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            (options.error || <span class="function"><span class="keyword">function</span>(<span class="params">xdr</span>) </span>&#123;&#125;)(xdr);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        xdr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> response = $.parseJSON(xdr.responseText);</span><br><span class="line">            (options.success || <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>) </span>&#123;&#125;)(response);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        xdr.onprogress = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            (options.onprogress || <span class="function"><span class="keyword">function</span>(<span class="params">xdr</span>) </span>&#123;&#125;)(xdr);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (newOptions.contentType.indexOf(<span class="string">"x-www-form-urlencoded"</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            newOptions.data = $.param(newOptions.data);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        xdr.timeout = newOptions.timeout;</span><br><span class="line">        xdr.open(newOptions.type, newOptions.url);</span><br><span class="line">        xdr.send(newOptions.data);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">normalAjax</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> newOptions = $.extend(<span class="literal">true</span>, &#123;&#125;, $.xAjax.normalAjaxDefaults, options);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (newOptions.url == <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(<span class="string">"options.url in undefined in normalAjax"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        newOptions.beforeSend = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            (options.beforeSend || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;)();</span><br><span class="line">        &#125;</span><br><span class="line">        newOptions.complete = <span class="function"><span class="keyword">function</span>(<span class="params">xhr</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> ajaxContext = <span class="keyword">this</span>;</span><br><span class="line">            $.proxy((options.complete || <span class="function"><span class="keyword">function</span>(<span class="params">xhr</span>) </span>&#123;&#125;), ajaxContext)(xhr);</span><br><span class="line">        &#125;</span><br><span class="line">        newOptions.error = <span class="function"><span class="keyword">function</span>(<span class="params">xhr</span>) </span>&#123;</span><br><span class="line">            (options.error || <span class="function"><span class="keyword">function</span>(<span class="params">xhr</span>) </span>&#123;&#125;)(xhr);</span><br><span class="line">        &#125;</span><br><span class="line">        newOptions.success = <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> ajaxContext = <span class="keyword">this</span>;</span><br><span class="line">            $.proxy((options.success || <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>) </span>&#123;&#125;), ajaxContext)(response);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> ajaxObj = $.ajax(newOptions);</span><br><span class="line">        <span class="keyword">return</span> ajaxObj;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> browserAjaxMap = &#123;</span><br><span class="line">        <span class="string">"MSIE 8"</span>: ieXDomainAjax,</span><br><span class="line">        <span class="string">"MSIE 9"</span>: ieXDomainAjax,</span><br><span class="line">        <span class="string">"MSIE 10"</span>: ieXDomainAjax</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    $.xAjax = <span class="function"><span class="keyword">function</span>(<span class="params">options, xDomain</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> ajaxFunction = xDomainAjaxMap[xDomain] || normalAjax;</span><br><span class="line">        <span class="keyword">var</span> ajaxObj = ajaxFunction(options);</span><br><span class="line">        <span class="keyword">return</span> ajaxObj;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    $.xAjax.normalAjaxDefaults = &#123;</span><br><span class="line">        type: <span class="string">"post"</span>,</span><br><span class="line">        data: &#123;&#125;,</span><br><span class="line">        dataType: <span class="string">"json"</span>,</span><br><span class="line">        cache: <span class="literal">false</span>,</span><br><span class="line">        contentType: <span class="string">"application/json;charset=utf-8"</span>,</span><br><span class="line">        headers: &#123;</span><br><span class="line">            Accept: <span class="string">"application/json, */*; version=1.0; charset=utf-8;"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        timeout: <span class="number">60000</span>,</span><br><span class="line">        <span class="keyword">async</span>: <span class="literal">true</span>,</span><br><span class="line">        global: <span class="literal">false</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    $.xAjax.ieXDomainAjaxDefaults = &#123;</span><br><span class="line">        timeout: <span class="number">60000</span>,</span><br><span class="line">        type: <span class="string">"post"</span>,</span><br><span class="line">        data: &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    $.xAjax.defaults = &#123;</span><br><span class="line">        xType: <span class="string">"xDomain"</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> xDomainStr = $.xAjax.defaults.xType;</span><br><span class="line">    <span class="keyword">var</span> xDomainAjaxMap = &#123;&#125;;</span><br><span class="line">    xDomainAjaxMap[xDomainStr] = browserAjaxMap[$.ipc.Browser.prototype.type + <span class="string">' '</span> + $.ipc.Browser.prototype.version] || normalAjax;</span><br><span class="line">&#125;)(jQuery);</span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串版本比较。部分需求需要针对字符串类型的版本号进行比较大小。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">$.ipc.compareVersion = <span class="function"><span class="keyword">function</span> <span class="title">versionCompare</span>(<span class="params">v1, v2, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> defaultOptions = &#123;</span><br><span class="line">        lexicographical: <span class="literal">false</span>,</span><br><span class="line">        zeroExtend: <span class="literal">true</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> _options = $.extend(<span class="literal">true</span>, defaultOptions, options);</span><br><span class="line">    <span class="keyword">var</span> lexicographical = _options &amp;&amp; _options.lexicographical,</span><br><span class="line">        zeroExtend = _options &amp;&amp; _options.zeroExtend,</span><br><span class="line">        v1parts = v1.split(<span class="string">'.'</span>),</span><br><span class="line">        v2parts = v2.split(<span class="string">'.'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">isValidPart</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (lexicographical ? <span class="regexp">/^\d+[A-Za-z]*$/</span> : <span class="regexp">/^\d+$/</span>).test(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!v1parts.every(isValidPart) || !v2parts.every(isValidPart)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NaN</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (zeroExtend) &#123;</span><br><span class="line">        <span class="keyword">while</span> (v1parts.length &lt; v2parts.length) v1parts.push(<span class="string">"0"</span>);</span><br><span class="line">        <span class="keyword">while</span> (v2parts.length &lt; v1parts.length) v2parts.push(<span class="string">"0"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!lexicographical) &#123;</span><br><span class="line">        v1parts = v1parts.map(<span class="built_in">Number</span>);</span><br><span class="line">        v2parts = v2parts.map(<span class="built_in">Number</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; v1parts.length; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v2parts.length == i) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (v1parts[i] == v2parts[i]) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v1parts[i] &gt; v2parts[i]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (v1parts.length != v2parts.length) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/04/22/ipc-web重构 (七) 技术亮点/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          ipc-web重构 (七) 技术亮点
        
      </div>
    </a>
  
  
    <a href="/2016/04/21/ipc-web重构 (五) 构建工具/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">ipc-web重构 (五) 构建工具</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>








</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Jone Xu
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>